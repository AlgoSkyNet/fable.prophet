<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the fable interface for prophet • fable.prophet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the fable interface for prophet">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149365901-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-149365901-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fable.prophet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/intro.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to the fable interface for prophet</h1>
            
      
      
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tsibble)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(fable.prophet)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Loading required package: Rcpp</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; Loading required package: fabletools</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; Attaching package: 'fabletools'</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; The following object is masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt;     decompose</span></a></code></pre></div>
<p>The <code>fable.prophet</code> package provides an interface allowing the <a href="https://facebook.github.io/prophet/">prophet forecasting procedure</a> to be used within the <a href="http://fable.tidyverts.org/">fable framework</a>. This allows you to use prophet to forecast multiple time series within the same workflow as other forecasting models. The interface provides a compact and flexible model specification, allowing you to create prophet models using a model formula.</p>
<div id="tidy-temporal-data" class="section level2">
<h2 class="hasAnchor">
<a href="#tidy-temporal-data" class="anchor"></a>Tidy temporal data</h2>
<p>The tidy temporal data structure <a href="http://tsibbledata.tidyverts.org/">tsibble</a> is used to represent time series data. A <code>tsibble</code> is extends the <code>data.frame</code> used in the <a href="https://cran.r-project.org/package=prophet">prophet</a> package with the concepts of <code>index</code> and <code>key</code> variables. The <code>index</code> refers to the column of data containing the observations measurement time (the <code>ds</code> column in prophet). The <code>key</code> variables are used to uniquely identify each time series in the dataset, allowing separate prophet models to be applied on each time series.</p>
<p>For this analysis let’s compare the number of domestic and international passengers passing through Los Angeles International Airport. The data is published by data.lacity.org and available on <a href="https://catalog.data.gov/dataset/los-angeles-international-airport-passenger-traffic-by-terminal-756ee">data.gov</a>. The data is re-hosted in this package’s GitHub repository for reproducibility.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Read in the data</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">lax_passengers &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"https://raw.githubusercontent.com/mitchelloharawild/fable.prophet/master/data-raw/lax_passengers.csv"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># Tidy and summarise the data for comparison of international and domestic passenger counts</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lubridate)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">lax_passengers &lt;-<span class="st"> </span>lax_passengers <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">datetime =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_hms</a></span>(ReportPeriod)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="dt">month =</span> <span class="kw"><a href="https://tsibble.tidyverts.org/reference/period.html">yearmonth</a></span>(datetime), <span class="dt">type =</span> Domestic_International) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">passengers =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(Passenger_Count)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">lax_passengers</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; # A tibble: 318 x 3</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt;       month type          passengers</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt;       &lt;mth&gt; &lt;fct&gt;              &lt;int&gt;</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt;  1 2006 Jan Domestic         3315937</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt;  2 2006 Jan International    1440222</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt;  3 2006 Feb Domestic         3045963</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt;  4 2006 Feb International    1204192</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt;  5 2006 Mar Domestic         3711057</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt;  6 2006 Mar International    1379237</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt;  7 2006 Apr Domestic         3683040</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt;  8 2006 Apr International    1404834</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt;  9 2006 May Domestic         3743141</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">#&gt; 10 2006 May International    1434267</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">#&gt; # … with 308 more rows</span></a></code></pre></div>
<p>The <code>data.frame</code> created contains two time series, one for domestic and another for international passenger counts. A <code>data.frame</code> can be converted to a <code>tsibble</code> using <code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble()</a></code> and specifying the <code>index</code> and <code>key</code> variable(s). In this case the time variable (the <code>index</code>) is <code>date</code>, and the <code>type</code> variable is the key as it uniquely identifies each time series.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Convert to a tsibble</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tsibble)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">lax_passengers &lt;-<span class="st"> </span><span class="kw"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span>(lax_passengers, <span class="dt">index =</span> month, <span class="dt">key =</span> type)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">lax_passengers</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; # A tsibble: 318 x 3 [1M]</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; # Key:       type [2]</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;       month type     passengers</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;       &lt;mth&gt; &lt;fct&gt;         &lt;int&gt;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;  1 2006 Jan Domestic    3315937</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt;  2 2006 Feb Domestic    3045963</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  3 2006 Mar Domestic    3711057</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;  4 2006 Apr Domestic    3683040</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt;  5 2006 May Domestic    3743141</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt;  6 2006 Jun Domestic    3994798</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt;  7 2006 Jul Domestic    4236581</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt;  8 2006 Aug Domestic    4128492</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt;  9 2006 Sep Domestic    3386421</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; 10 2006 Oct Domestic    3598030</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; # … with 308 more rows</span></a></code></pre></div>
<p>When using <code>fable.prophet</code>, it is not necessary to have the time column named <code>ds</code> and the response column called <code>y</code>.</p>
</div>
<div id="data-exploration" class="section level2">
<h2 class="hasAnchor">
<a href="#data-exploration" class="anchor"></a>Data exploration</h2>
<p>Before modelling, we should first have a look at the data. There are many ways in which time series data can be visualised, and as a <code>tsibble</code> is in a tabular format you can easily create informative graphics with <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>. The easiest way to have a quickly see your data is with a time series plot via <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">lax_passengers <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw">autoplot</span>(passengers)</a></code></pre></div>
<p><img src="intro_files/figure-html/plot-1.png" width="672"></p>
<p>Each series appears to have a piecewise linear trend and multiplicative seasonality, which we should consider when creating our prophet model. The <a href="https://cran.r-project.org/package=feasts">feasts</a> and <a href="https://cran.r-project.org/package=sugrrants">sugrrants</a> packages provide additional plotting tools for time series data.</p>
</div>
<div id="prophet-modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#prophet-modelling" class="anchor"></a>Prophet modelling</h2>
<p>A prophet model is specified using the <code><a href="../reference/prophet.html">prophet()</a></code> function. If you’ve loaded both <code>prophet</code> and <code>fable.prophet</code> packages, you should refer to this function explicitly with <code><a href="../reference/prophet.html">fable.prophet::prophet()</a></code>. This function uses a formula based model specification (<code>y ~ x</code>), where the left of the formula specifies the response variable, and the right specifies the model’s predictive terms.</p>
<p>A prophet model supports piecewise linear or exponential growth (trend), additive or multiplicative seasonality, holiday effects and exogenous regressors. More details about how to specify these terms can be found in the help file, <code><a href="../reference/prophet.html">?prophet</a></code>.</p>
<p>To specify a linear growth and a annual multiplicative seasonal pattern for the passengers data above, you would use:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/prophet.html">prophet</a></span>(passengers <span class="op">~</span><span class="st"> </span><span class="kw">growth</span>(<span class="st">"linear"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">season</span>(<span class="st">"year"</span>, <span class="dt">type =</span> <span class="st">"multiplicative"</span>))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; &lt;prophet model definition&gt;</span></a></code></pre></div>
<p>You can also use prophet’s automatic model specification by not specifying the right hand side, i.e. <code><a href="../reference/prophet.html">prophet(passengers)</a></code>.</p>
<p>The <code>model()</code> function is used to estimate a specified model using the data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">fit &lt;-<span class="st"> </span>lax_passengers <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">model</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="dt">mdl =</span> <span class="kw"><a href="../reference/prophet.html">prophet</a></span>(passengers <span class="op">~</span><span class="st"> </span><span class="kw">growth</span>(<span class="st">"linear"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">season</span>(<span class="st">"year"</span>, <span class="dt">type =</span> <span class="st">"multiplicative"</span>)),</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">fit</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; # A mable: 2 x 2</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; # Key:     type [2]</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;   type          mdl      </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;   &lt;fct&gt;         &lt;model&gt;  </span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; 1 Domestic      &lt;prophet&gt;</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; 2 International &lt;prophet&gt;</span></a></code></pre></div>
<p>You can see that two prophet models have been estimated, one for each of the time series in the dataset.</p>
</div>
<div id="prophet-components" class="section level2">
<h2 class="hasAnchor">
<a href="#prophet-components" class="anchor"></a>Prophet components</h2>
<p>The components of an estimated prophet model can be extracted using the <code>components()</code> function. This allows you to visualise the terms of the model.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">components</span>(fit)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; # A dable:               318 x 9 [1M]</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; # Key:                   type, .model [2]</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; # Prophet Decomposition: passengers = trend * (1 + multiplicative_terms) +</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; #   additive_terms + .resid</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;    type  .model      month passengers additive_terms multiplicative_…</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;    &lt;fct&gt; &lt;chr&gt;       &lt;mth&gt;      &lt;int&gt;          &lt;dbl&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  1 Dome… mdl      2006 Jan    3315937              0        -0.0962  </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  2 Dome… mdl      2006 Feb    3045963              0        -0.177   </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  3 Dome… mdl      2006 Mar    3711057              0         0.000769</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  4 Dome… mdl      2006 Apr    3683040              0        -0.0180  </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  5 Dome… mdl      2006 May    3743141              0         0.0317  </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  6 Dome… mdl      2006 Jun    3994798              0         0.0946  </span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;  7 Dome… mdl      2006 Jul    4236581              0         0.150   </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;  8 Dome… mdl      2006 Aug    4128492              0         0.117   </span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt;  9 Dome… mdl      2006 Sep    3386421              0        -0.0687  </span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; 10 Dome… mdl      2006 Oct    3598030              0        -0.00806 </span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; # … with 308 more rows, and 3 more variables: trend &lt;dbl&gt;, year &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; #   .resid &lt;dbl&gt;</span></a></code></pre></div>
<p>The resulting decomposition table (a <code>dable</code>) can be visualised using <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">components</span>(fit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw">autoplot</span>()</a></code></pre></div>
<p><img src="intro_files/figure-html/components-plot-1.png" width="672"></p>
<p>The models for each series appear to have similar characteristics, with the domestic passenger counts being more seasonal than international counts.</p>
<p>As a <code>dable</code> is in a tabular structure, it is also possible to use <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> or other plotting libraries to make more sophisticated graphics. Here I produce a plot of seasonality that is wrapped over each year, yielding a very similar result to <code><a href="https://rdrr.io/pkg/prophet/man/prophet_plot_components.html">prophet::prophet_plot_components()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">components</span>(fit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    <span class="co"># Plot the month of the time index (month) on the x-axis</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="dt">x =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span>(month, <span class="dt">label =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    <span class="co"># Plot the annual seasonal term (year) on the y-axis</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="dt">y =</span> year, </a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    <span class="co"># Colour by the passenger type</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    <span class="dt">colour =</span> type,</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    <span class="co"># Draw separate lines for each type and year</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    <span class="dt">group =</span> <span class="kw"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span>(type, <span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(month))</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">  )) <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</a></code></pre></div>
<p><img src="intro_files/figure-html/components-seasonal-1.png" width="672"></p>
<p>Peak monthly passenger counts seem to occur in July, and the minimum is in February (although be wary of differences in the number of days in each month!). You can see that the model’s seasonal term changes slightly from year to year, especially for domestic passengers in March and November.</p>
</div>
<div id="forecasting-with-prophet" class="section level2">
<h2 class="hasAnchor">
<a href="#forecasting-with-prophet" class="anchor"></a>Forecasting with prophet</h2>
<p>Forecasts from an estimated model can be produced using the <code>forecast()</code> function. If the model has not used exogenous regressors, the number of forecasts (forecast horizon) can be easily specified using the <code>h</code> argument. If exogenous regressors have been used, these will need to be included in a tsibble passed to the <code>new_data</code> argument.</p>
<p>To forecast three years into the future, we can set <code>h = "3 years"</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">fc &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw">forecast</span>(<span class="dt">h =</span> <span class="st">"3 years"</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">fc</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; # A fable: 72 x 5 [1M]</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; # Key:     type, .model [2]</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt;    type     .model    month passengers .distribution  </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;    &lt;fct&gt;    &lt;chr&gt;     &lt;mth&gt;      &lt;dbl&gt; &lt;dist&gt;         </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;  1 Domestic mdl    2019 Apr   5217502. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;  2 Domestic mdl    2019 May   5495443. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;  3 Domestic mdl    2019 Jun   5812394. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;  4 Domestic mdl    2019 Jul   6153169. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;  5 Domestic mdl    2019 Aug   5992971. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;  6 Domestic mdl    2019 Sep   4999765. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;  7 Domestic mdl    2019 Oct   5344708. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;  8 Domestic mdl    2019 Nov   5142208. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt;  9 Domestic mdl    2019 Dec   5322615. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; 10 Domestic mdl    2020 Jan   4873109. sim(=dbl[1000])</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; # … with 62 more rows</span></a></code></pre></div>
<p>The point forecasts are provided in the <code>passengers</code> column, and a set of simulated future paths are stored in the <code>.distribution</code> column. To visualise these forecasts, we can again use the <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">fc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(lax_passengers)</a></code></pre></div>
<p><img src="intro_files/figure-html/forecast-plot-1.png" width="672"></p>
</div>
<div id="evaluating-accuracy" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluating-accuracy" class="anchor"></a>Evaluating accuracy</h2>
<p>Much like any model in the fable framework, model and forecast accuracy can be evaluated using the <code>accuracy()</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">accuracy</span>(fit)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt; # A tibble: 2 x 10</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt;   type         .model .type      ME   RMSE    MAE     MPE  MAPE  MASE  ACF1</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt;   &lt;fct&gt;        &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; 1 Domestic     mdl    Traini… -181. 77251. 62175. -0.0664  1.56 0.343 0.440</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; 2 Internation… mdl    Traini…  171. 46292. 34798. -0.0683  2.26 0.357 0.729</span></a></code></pre></div>
<p>When comparing accuracy between series on different scales, it is important to use a scale independent accuracy measure. A summary of accuracy measures can be found in the <a href="https://otexts.com/fpp3/accuracy.html"><em>Forecasting: Principles and Practice</em> - Evaluating forecast accuracy</a>. An appropriate accuracy measure for comparing these models is the mean absolute scaled error (MASE). We can interpret the model for domestic passenger counts as being slightly more accurate on the training data as it has a slightly lower MASE.</p>
<p>Comparing in-sample (training) accuracy may misrepresent the accuracy of a model, as it is based on predicting one-step ahead using all available data. In many senses this is unrealistic, and there are other approaches such as out-of-sample (test) accuracy and cross-validation which can be used. The freely available online textbook also details how to compute these more realistic accuracy measures.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#tidy-temporal-data">Tidy temporal data</a></li>
      <li><a href="#data-exploration">Data exploration</a></li>
      <li><a href="#prophet-modelling">Prophet modelling</a></li>
      <li><a href="#prophet-components">Prophet components</a></li>
      <li><a href="#forecasting-with-prophet">Forecasting with prophet</a></li>
      <li><a href="#evaluating-accuracy">Evaluating accuracy</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://mitchelloharawild.com">Mitchell O'Hara-Wild</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
